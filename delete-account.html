<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>계정 삭제</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h2>계정 삭제</h2>

<p>계정을 삭제하면 모든 프로필 정보와 주문 기록이 삭제됩니다.</p>

<label for="rePasswordInput">비밀번호 입력:</label>
<input id="rePasswordInput" type="password" placeholder="비밀번호">
<button id="deleteBtn">계정 삭제</button>

<script>
  // Firebase 초기화
  const firebaseConfig = {
    apiKey: "AIzaSyC0A1fklf_F9fsGEJptZEgwY6P8m2AOtP8",
    authDomain: "fd10000001.firebaseapp.com",
    databaseURL: "https://fd10000001-default-rtdb.firebaseio.com",
    projectId: "fd10000001",
    storageBucket: "fd10000001.appspot.com",
    appId: "1:571996607501:android:063995f371441a5c107144"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const deleteBtn = document.getElementById("deleteBtn");

  deleteBtn.addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) { alert("로그인 상태여야 합니다."); return; }

    const rePassword = document.getElementById("rePasswordInput").value;
    if (!rePassword) { alert("비밀번호를 입력하세요."); return; }

    if (!confirm("정말로 계정과 모든 데이터를 삭제하시겠습니까?")) return;

    try {
      // 재인증
      const credential = firebase.auth.EmailAuthProvider.credential(user.email, rePassword);
      await user.reauthenticateWithCredential(credential);

      // DB 삭제 (Auth UID 기준)
      const uid = user.uid;
      await db.ref("users/" + uid).remove();
      await db.ref("orders/" + uid).remove();

      // 계정 삭제
      await user.delete();
      await auth.signOut();

      Android.logFromJs("계정 삭제 완료: " + uid);
      alert("계정과 데이터가 삭제되었습니다.");
      window.location.href = "/";

    } catch(err) {
      console.error(err);
      Android.logFromJs("삭제 실패: " + err.message);
      alert("삭제 실패: " + err.message);
    }
  });
</script>
</body>
</html>
